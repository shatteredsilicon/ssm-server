global:
  scrape_interval:     60s
  scrape_timeout:      10s
  evaluation_interval: 60s

scrape_configs:
  - job_name: prometheus
    scrape_interval: 1s
    scrape_timeout:  1s
    metrics_path: /prometheus/metrics
    static_configs:
      - targets: ['localhost:9090']
        labels:
          instance: ssm-server


  - job_name: grafana
    scrape_interval: 5s
    scrape_timeout:  4s
    static_configs:
      - targets: ['localhost:3000']
        labels:
          instance: ssm-server


  - job_name: linux
    scrape_interval: 1s
    scrape_timeout:  1s
    basic_auth:
      username: ENV_SERVER_USER
      password: ENV_SERVER_PASSWORD

    tls_config:
      insecure_skip_verify: true

    consul_sd_configs:
    - server:   'localhost:8500'
      datacenter: dc1
      services: ['linux:metrics']

    relabel_configs:
    - target_label:  'job'
      replacement:   'linux'
    - source_labels: ['__meta_consul_tags']
      regex:         '.*,alias_([-\w:\.]+),.*'
      target_label:  'instance'
      replacement:   '$1'
    - source_labels: ['__meta_consul_tags']
      regex:         '.*,scheme_([\w]+),.*'
      target_label:  '__scheme__'
      replacement:   '$1'
    - source_labels: ['__meta_consul_tags']
      regex:         '.*,region_([\w]+),.*'
      target_label:  'region'
      replacement:   '$1'

    static_configs:
      - targets: ['localhost:9100']
        labels:
          instance: ssm-server

    metric_relabel_configs:
    - source_labels: [__name__]
      regex: (node_disk_reads_completed|node_disk_writes_completed|node_disk_io_time_ms|node_intr|node_forks|node_context_switches|node_vmstat_pswpin|node_vmstat_pswpout|node_vmstat_pgpgin|node_vmstat_pgpgout|node_disk_write_time_ms|node_disk_read_time_ms|node_network_receive_bytes|node_network_transmit_bytes|node_disk_reads_merged|node_disk_writes_merged|node_disk_sectors_read|node_disk_sectors_written|node_netstat_Tcp_RetransSegs|node_netstat_Tcp_OutSegs|node_netstat_Tcp_InSegs|node_netstat_Udp_InDatagrams|node_netstat_Udp_InErrors|node_netstat_Udp_OutDatagrams|node_netstat_Udp_NoPorts|node_netstat_Udp_InCsumErrors|node_netstat_Udp_RcvbufErrors|node_netstat_Udp_SndbufErrors|node_netstat_UdpLite_InDatagrams|node_netstat_UdpLite_OutDatagrams|node_netstat_UdpLite_InCsumErrors|node_netstat_UdpLite_InErrors|node_netstat_UdpLite_RcvbufErrors|node_netstat_UdpLite_SndbufErrors|node_netstat_UdpLite_NoPorts|node_netstat_Icmp_InErrors|node_netstat_Icmp_OutErrors|node_netstat_Icmp_InDestUnreachs|node_netstat_Icmp_OutDestUnreachs|node_netstat_IcmpMsg_InType3|node_netstat_IcmpMsg_OutType3|node_netstat_Icmp_InCsumErrors|node_netstat_Icmp_InTimeExcds|node_netstat_Icmp_InMsgs|node_netstat_Icmp_InRedirects|node_netstat_Icmp_OutMsgs|node_netstat_Icmp_OutRedirects|node_netstat_Icmp_InEchoReps|node_netstat_Icmp_InEchos|node_netstat_Icmp_OutEchoReps|node_netstat_Icmp_OutEchos|node_netstat_Icmp_InAddrMaskReps|node_netstat_Icmp_OutAddrMasks|node_netstat_Icmp_InTimestamps|node_netstat_Icmp_OutTimestamps|node_netstat_Icmp_OutTimestampReps|node_netstat_Icmp_InTimestampReps|node_netstat_Icmp_InAddrMasks|node_netstat_Icmp_OutAddrMaskReps|node_netstat_Tcp_OutRsts|node_network_receive_packets|node_network_transmit_packets|node_network_receive_errs|node_network_transmit_errs|node_network_receive_drop|node_network_transmit_drop|node_network_receive_multicast|node_network_transmit_multicast|node_netstat_Tcp_InCsumErrors|node_netstat_Tcp_InErrs)
      target_label: __name__
      replacement: ${1}_total
      action: replace
    - source_labels: [__name__]
      regex: node_disk_bytes_read
      target_label: __name__
      replacement: node_disk_read_bytes_total
      action: replace
    - source_labels: [__name__]
      regex: node_disk_bytes_written
      target_label: __name__
      replacement: node_disk_written_bytes_total
      action: replace
    - source_labels: [__name__]
      regex: node_cpu
      target_label: __name__
      replacement: node_cpu_seconds_total
      action: replace


  - job_name: proxysql
    scrape_interval: 1s
    scrape_timeout:  1s
    basic_auth:
      username: ENV_SERVER_USER
      password: ENV_SERVER_PASSWORD

    tls_config:
      insecure_skip_verify: true

    consul_sd_configs:
    - server:   'localhost:8500'
      datacenter: dc1
      services: ['proxysql:metrics']

    relabel_configs:
    - target_label:  'job'
      replacement:   'proxysql'
    - source_labels: ['__meta_consul_tags']
      regex:         '.*,alias_([-\w:\.]+),.*'
      target_label:  'instance'
      replacement:   '$1'
    - source_labels: ['__meta_consul_tags']
      regex:         '.*,scheme_([\w]+),.*'
      target_label:  '__scheme__'
      replacement:   '$1'
    - source_labels: ['__meta_consul_tags']
      regex:         '.*,region_([\w]+),.*'
      target_label:  'region'
      replacement:   '$1'

    metric_relabel_configs:
    - source_labels: [__name__]
      separator: ;
      regex: (proxysql_mysql_status_questions|proxysql_connection_pool_conn_err|proxysql_connection_pool_queries|proxysql_mysql_status_query_processor_time_nsec|proxysql_mysql_status_query_cache_count_get_ok|proxysql_mysql_status_query_cache_count_get|proxysql_mysql_status_query_cache_bytes_out|proxysql_mysql_status_query_cache_bytes_in|proxysql_connection_pool_bytes_data_recv|proxysql_connection_pool_bytes_data_sent)
      target_label: __name__
      replacement: ${1}_total
      action: replace

  - job_name: mongodb
    scrape_interval: 1s
    scrape_timeout:  1s
    basic_auth:
      username: ENV_SERVER_USER
      password: ENV_SERVER_PASSWORD

    tls_config:
      insecure_skip_verify: true

    consul_sd_configs:
    - server:   'localhost:8500'
      datacenter: dc1
      services: ['mongodb:metrics']

    relabel_configs:
    - target_label:  'job'
      replacement:   'mongodb'
    - source_labels: ['__meta_consul_tags']
      regex:         '.*,alias_([-\w:\.]+),.*'
      target_label:  'instance'
      replacement:   '$1'
    - source_labels: ['__meta_consul_tags']
      regex:         '.*,scheme_([\w]+),.*'
      target_label:  '__scheme__'
      replacement:   '$1'
    - source_labels: ['__meta_consul_tags']
      regex:         '.*,cluster_([-\w:\.]+),.*'
      target_label:  'cluster'
      replacement:   '$1'
    - source_labels: ['__meta_consul_tags']
      regex:         '.*,region_([\w]+),.*'
      target_label:  'region'
      replacement:   '$1'

    metric_relabel_configs:
    - source_labels: [__name__]
      separator: ;
      regex: (mongodb_mongod_durability_journaled_megabytes|mongodb_mongod_durability_write_to_data_files_megabytes|mongodb_mongod_durability_commits|mongodb_mongod_background_flushing_average_milliseconds|mongodb_mongod_metrics_get_last_error_wtime_total_milliseconds|mongodb_mongos_metrics_get_last_error_wtime_total_milliseconds|mongodb_mongod_metrics_repl_network_getmores_total_milliseconds|mongodb_mongod_metrics_repl_preload_docs_total_milliseconds|mongodb_mongod_metrics_repl_preload_indexes_total_milliseconds|mongodb_mongod_metrics_repl_apply_batches_total_milliseconds|mongodb_mongod_rocksdb_compaction_bytes_per_second)
      target_label: __name__
      replacement: ${1}_total
      action: replace


  - job_name: postgresql
    scrape_interval: 1s
    scrape_timeout:  1s
    metrics_path: /metrics
    basic_auth:
      username: ENV_SERVER_USER
      password: ENV_SERVER_PASSWORD

    tls_config:
      insecure_skip_verify: true

    consul_sd_configs:
    - server:   'localhost:8500'
      datacenter: dc1
      services: ['postgresql:metrics']

    relabel_configs:
    - target_label:  'job'
      replacement:   'postgresql'
    - source_labels: ['__meta_consul_tags']
      regex:         '.*,alias_([-\w:\.]+),.*'
      target_label:  'instance'
      replacement:   '$1'
    - source_labels: ['__meta_consul_tags']
      regex:         '.*,scheme_([\w]+),.*'
      target_label:  '__scheme__'
      replacement:   '$1'
    - source_labels: ['__meta_consul_tags']
      regex:         '.*,region_([\w]+),.*'
      target_label:  'region'
      replacement:   '$1'

    metric_relabel_configs:
    - source_labels: [__name__]
      separator: ;
      regex: (pg_stat_database_xact_commit|pg_stat_database_xact_rollback|pg_stat_database_temp_bytes|pg_stat_database_deadlocks|pg_stat_database_conflicts|pg_stat_database_blk_read_time|pg_stat_database_blk_write_time|pg_stat_bgwriter_buffers_alloc|pg_stat_bgwriter_checkpoint_write_time|pg_stat_bgwriter_checkpoint_sync_time|pg_stat_database_conflicts_confl_tablespace|pg_stat_database_conflicts_confl_snapshot|pg_stat_database_conflicts_confl_lock|pg_stat_database_conflicts_confl_deadlock|pg_stat_database_conflicts_confl_bufferpin|pg_stat_bgwriter_buffers_checkpoint|pg_stat_bgwriter_buffers_clean|pg_stat_bgwriter_buffers_backend|pg_stat_bgwriter_buffers_backend_fsync|pg_stat_database_tup_fetched|pg_stat_database_tup_returned|pg_stat_database_tup_inserted|pg_stat_database_tup_updated|pg_stat_database_tup_deleted)
      target_label: __name__
      replacement: ${1}_total
      action: replace

  - job_name: mysql-hr
    scrape_interval: 1s
    scrape_timeout:  1s
    metrics_path: /metrics-hr
    basic_auth:
      username: ENV_SERVER_USER
      password: ENV_SERVER_PASSWORD

    tls_config:
      insecure_skip_verify: true

    consul_sd_configs:
    - server:   'localhost:8500'
      datacenter: dc1
      services: ['mysql:metrics']

    relabel_configs:
    - target_label:  'job'
      replacement:   'mysql'
    - source_labels: ['__meta_consul_tags']
      regex:         '.*,alias_([-\w:\.]+),.*'
      target_label:  'instance'
      replacement:   '$1'
    - source_labels: ['__meta_consul_tags']
      regex:         '.*,scheme_([\w]+),.*'
      target_label:  '__scheme__'
      replacement:   '$1'
    - source_labels: ['__meta_consul_tags']
      regex:         '.*,region_([\w]+),.*'
      target_label:  'region'
      replacement:   '$1'

    metric_relabel_configs:
    - source_labels: [__name__]
      separator: ;
      regex: (mysql_global_status_binlog_cache_use|mysql_global_status_binlog_cache_disk_use|mysql_global_variables_binlog_cache_size|mysql_global_status_binlog_stmt_cache_use|mysql_global_status_binlog_stmt_cache_disk_use|mysql_global_variables_binlog_stmt_cache_size|mysql_global_status_connections|mysql_global_status_queries|mysql_global_status_questions|mysql_global_status_created_tmp_tables|mysql_global_status_created_tmp_disk_tables|mysql_global_status_created_tmp_files|mysql_global_status_select_full_join|mysql_global_status_select_full_range_join|mysql_global_status_select_range|mysql_global_status_select_range_check|mysql_global_status_select_scan|mysql_global_status_sort_rows|mysql_global_status_sort_range|mysql_global_status_sort_merge_passes|mysql_global_status_sort_scan|mysql_global_status_slow_queries|mysql_global_status_aborted_connects|mysql_global_status_aborted_clients|mysql_global_status_table_locks_immediate|mysql_global_status_table_locks_waited|mysql_global_status_threads_created|mysql_global_status_bytes_received|mysql_global_status_bytes_sent|mysql_global_status_auroradb_commits|mysql_global_status_auroradb_commit_latency|mysql_global_status_auroradb_ddl_stmt_duration|mysql_global_status_auroradb_select_stmt_duration|mysql_global_status_auroradb_insert_stmt_duration|mysql_global_status_auroradb_update_stmt_duration|mysql_global_status_auroradb_delete_stmt_duration|mysql_global_status_qcache_hits|mysql_global_status_qcache_inserts|mysql_global_status_qcache_not_cached|mysql_global_status_qcache_lowmem_prunes|mysql_global_status_opened_files|mysql_global_status_opened_tables|mysql_global_status_table_open_cache_hits|mysql_global_status_table_open_cache_misses|mysql_global_status_opened_table_definitions|mysql_global_status_table_open_cache_overflows|mysql_global_status_auroradb_thread_deadlocks|mysql_global_status_aurora_missing_history_on_replica_incidents|mysql_global_status_aurora_reserved_mem_exceeded_incidents|mysql_global_status_key_reads|mysql_global_status_key_read_requests|mysql_global_status_key_writes|mysql_global_status_aria_pagecache_reads|mysql_global_status_aria_pagecache_writes|mysql_global_status_aria_transaction_log_syncs|mysql_global_status_aria_pagecache_read_requests|mysql_global_status_aria_pagecache_write_requests|mysql_global_status_key_write_requests|mysql_global_status_innodb_max_trx_id|mysql_global_status_innodb_log_writes|mysql_global_status_innodb_os_log_written|mysql_global_status_innodb_onlineddl_rowlog_pct_used|mysql_global_status_innodb_onlineddl_rowlog_rows|mysql_global_status_innodb_defragment_compression_failures|mysql_global_status_innodb_defragment_failures|mysql_global_status_innodb_row_lock_waits|mysql_global_status_innodb_row_lock_time|mysql_global_status_innodb_data_reads|mysql_global_status_innodb_data_writes|mysql_global_status_innodb_data_fsyncs|mysql_global_status_innodb_deadlocks|mysql_global_status_innodb_buffer_pool_read_requests|mysql_global_status_innodb_buffer_pool_write_requests|mysql_global_status_innodb_buffer_pool_reads|mysql_global_status_innodb_pages_created|mysql_global_status_innodb_pages_read|mysql_global_status_innodb_pages_written|mysql_global_status_innodb_buffer_pool_read_ahead|mysql_global_status_innodb_buffer_pool_read_ahead_rnd|mysql_global_status_innodb_buffer_pool_read_ahead_evicted|mysql_global_status_innodb_ibuf_merges|mysql_global_status_innodb_ibuf_merged_inserts|mysql_global_status_innodb_ibuf_merged_deletes|mysql_global_status_innodb_ibuf_merged_delete_marks|mysql_global_status_rocksdb_block_cache_hit|mysql_global_status_rocksdb_block_cache_miss|mysql_global_status_rocksdb_block_cache_add|mysql_global_status_rocksdb_block_cache_add_failures|mysql_global_status_rocksdb_block_cache_bytes_read|mysql_global_status_rocksdb_block_cache_bytes_write|mysql_global_status_rocksdb_block_cache_index_hit|mysql_global_status_rocksdb_block_cache_index_miss|mysql_global_status_rocksdb_block_cache_index_add|mysql_global_status_rocksdb_block_cache_index_bytes_insert|mysql_global_status_rocksdb_block_cache_index_bytes_evict|mysql_global_status_rocksdb_block_cache_filter_hit|mysql_global_status_rocksdb_block_cache_filter_miss|mysql_global_status_rocksdb_block_cache_filter_add|mysql_global_status_rocksdb_block_cache_filter_bytes_insert|mysql_global_status_rocksdb_block_cache_filter_bytes_evic|mysql_global_status_rocksdb_block_cache_data_bytes_insert|mysql_global_status_rocksdb_bloom_filter_useful|mysql_global_status_rocksdb_memtable_hit|mysql_global_status_rocksdb_memtable_miss|mysql_global_status_rocksdb_number_keys_read|mysql_global_status_rocksdb_number_keys_written|mysql_global_status_rocksdb_number_keys_updated|mysql_global_status_rocksdb_get_hit_l0|mysql_global_status_rocksdb_get_hit_l1|mysql_global_status_rocksdb_number_db_seek|mysql_global_status_rocksdb_number_db_seek_found|mysql_global_status_rocksdb_number_db_next|mysql_global_status_rocksdb_number_db_next_found|mysql_global_status_rocksdb_number_db_prev|mysql_global_status_rocksdb_number_db_prev_found|mysql_global_status_rocksdb_bytes_read|mysql_global_status_rocksdb_bytes_written|mysql_global_status_rocksdb_iter_bytes_read|mysql_global_status_rocksdb_write_self|mysql_global_status_rocksdb_write_other|mysql_global_status_rocksdb_write_timeout|mysql_global_status_rocksdb_write_wal|mysql_global_status_rocksdb_wal_synced|mysql_global_status_rocksdb_wal_bytes|mysql_global_status_rocksdb_number_reseeks_iteration|mysql_global_status_rocksdb_rows_inserted|mysql_global_status_rocksdb_rows_updated|mysql_global_status_rocksdb_rows_deleted|mysql_global_status_rocksdb_rows_read|mysql_global_status_rocksdb_rows_expired|mysql_global_status_rocksdb_system_rows_deleted|mysql_global_status_rocksdb_system_rows_inserted|mysql_global_status_rocksdb_system_rows_read|mysql_global_status_rocksdb_system_rows_updated|mysql_global_status_rocksdb_no_file_opens|mysql_global_status_rocksdb_no_file_closes|mysql_global_status_rocksdb_no_file_errors|mysql_global_status_rocksdb_stall_l0_file_count_limit_slowdowns|mysql_global_status_rocksdb_stall_l0_file_count_limit_stops|mysql_global_status_rocksdb_stall_locked_l0_file_count_limit_slowdowns|mysql_global_status_rocksdb_stall_locked_l0_file_count_limit_stops|mysql_global_status_rocksdb_stall_memtable_limit_slowdowns|mysql_global_status_rocksdb_stall_memtable_limit_stops|mysql_global_status_tokudb_txn_begin|mysql_global_status_tokudb_txn_begin_read_only|mysql_global_status_tokudb_txn_commits|mysql_global_status_tokudb_txn_aborts|mysql_global_status_tokudb_messages_injected_at_root|mysql_global_status_tokudb_broadcase_messages_injected_at_root|mysql_global_status_tokudb_messages_injected_at_root_bytes|mysql_global_status_tokudb_messages_flushed_from_h1_to_leaves_bytes|mysql_global_status_tokudb_leaf_compression_to_memory_seconds|mysql_global_status_tokudb_leaf_decompression_to_memory_seconds|mysql_global_status_tokudb_leaf_serialization_to_memory_seconds|mysql_global_status_tokudb_leaf_deserialization_to_memory_seconds|mysql_global_status_tokudb_nonleaf_compression_to_memory_seconds|mysql_global_status_tokudb_nonleaf_decompression_to_memory_seconds|mysql_global_status_tokudb_nonleaf_serialization_to_memory_seconds|mysql_global_status_tokudb_nonleaf_deserialization_to_memory_seconds|mysql_global_status_tokudb_promotion_injections_at_depth_0|mysql_global_status_tokudb_promotion_injections_at_depth_1|mysql_global_status_tokudb_promotion_injections_at_depth_2|mysql_global_status_tokudb_promotion_injections_at_depth_3|mysql_global_status_tokudb_promotion_injections_lower_than_depth_3|mysql_global_status_tokudb_promotion_stopped_nonempty_buffer|mysql_global_status_tokudb_promotion_stopped_at_height_1|mysql_global_status_tokudb_promotion_stopped_child_locked_or_not_in_memory|mysql_global_status_tokudb_promotion_stopped_child_not_fully_in_memory|mysql_global_status_tokudb_promotion_stopped_after_locking_child|mysql_global_status_tokudb_leaf_nodes_created|mysql_global_status_tokudb_nonleaf_nodes_created|mysql_global_status_tokudb_leaf_nodes_destroyed|mysql_global_status_tokudb_nonleaf_nodes_destroyed|mysql_global_status_tokudb_messages_ignored_by_leaf_due_to_msn|mysql_global_status_tokudb_cursor_skip_deleted_leaf_entry|mysql_global_status_tokudb_leaf_entry_apply_gc_bytes_out|mysql_global_status_tokudb_leaf_entry_apply_gc_bytes_in|mysql_global_status_tokudb_cachetable_evictions|mysql_global_status_tokudb_cachetable_miss|mysql_global_status_tokudb_cachetable_miss_time|mysql_global_status_tokudb_cachetable_prefetches|mysql_global_status_tokudb_leaf_node_partial_evictions|mysql_global_status_tokudb_nonleaf_node_partial_evictions|mysql_global_status_tokudb_leaf_node_partial_evictions_bytes|mysql_global_status_tokudb_nonleaf_node_partial_evictions_bytes|mysql_global_status_tokudb_leaf_node_full_evictions|mysql_global_status_tokudb_nonleaf_node_full_evictions|mysql_global_status_tokudb_leaf_node_full_evictions_bytes|mysql_global_status_tokudb_nonleaf_node_full_evictions_bytes|mysql_global_status_tokudb_checkpoint_taken|mysql_global_status_tokudb_checkpoint_duration|mysql_global_status_tokudb_checkpoint_begin_time|mysql_global_status_tokudb_checkpoint_end_time|mysql_global_status_tokudb_leaf_nodes_flushed_checkpoint_seconds|mysql_global_status_tokudb_nonleaf_nodes_flushed_to_disk_checkpoint_seconds|mysql_global_status_tokudb_leaf_nodes_flushed_not_checkpoint_seconds|mysql_global_status_tokudb_nonleaf_nodes_flushed_to_disk_not_checkpoint_seconds|mysql_global_status_tokudb_leaf_nodes_flushed_checkpoint_bytes|mysql_global_status_tokudb_nonleaf_nodes_flushed_to_disk_checkpoint_bytes|mysql_global_status_tokudb_leaf_nodes_flushed_checkpoint_uncompressed_bytes|mysql_global_status_tokudb_nonleaf_nodes_flushed_to_disk_checkpoint_uncompressed_by|mysql_global_status_tokudb_leaf_nodes_flushed_not_checkpoint_bytes|mysql_global_status_tokudb_nonleaf_nodes_flushed_to_disk_not_checkpoint_bytes|mysql_global_status_tokudb_pivots_fetched_for_query_bytes|mysql_global_status_tokudb_pivots_fetched_for_prefetch_bytes|mysql_global_status_tokudb_pivots_fetched_for_write_bytes|mysql_global_status_tokudb_pivots_fetched_for_query_seconds|mysql_global_status_tokudb_pivots_fetched_for_prefetch_seconds|mysql_global_status_tokudb_pivots_fetched_for_write_seconds|mysql_global_status_tokudb_basements_fetched_target_query_bytes|mysql_global_status_tokudb_basements_fetched_prefetch_bytes|mysql_global_status_tokudb_basements_fetched_for_write_bytes|mysql_global_status_tokudb_basements_fetched_prelocked_range_bytes|mysql_global_status_tokudb_basements_fetched_target_query_seconds|mysql_global_status_tokudb_basements_fetched_prefetch_seconds|mysql_global_status_tokudb_basements_fetched_for_write_seconds|mysql_global_status_tokudb_basements_fetched_prelocked_range_seconds|mysql_global_status_tokudb_buffers_fetched_target_query_bytes|mysql_global_status_tokudb_buffers_fetched_prefetch_bytes|mysql_global_status_tokudb_buffers_fetched_for_write_bytes|mysql_global_status_tokudb_buffers_fetched_prelocked_range_bytes|mysql_global_status_tokudb_buffers_fetched_target_query_seconds|mysql_global_status_tokudb_buffers_fetched_prefetch_seconds|mysql_global_status_tokudb_buffers_fetched_for_write_seconds|mysql_global_status_tokudb_buffers_fetched_prelocked_range_seconds|mysql_global_status_tokudb_logger_writes|mysql_global_status_tokudb_logger_writes_bytes|mysql_global_status_tokudb_filesystem_fsync_num|mysql_global_status_tokudb_logger_writes_seconds|mysql_global_status_tokudb_filesystem_fsync_time|mysql_global_status_tokudb_locktree_wait_time|mysql_global_status_tokudb_cachetable_cleaner_executions|mysql_global_status_tokudb_cachetable_pool_client_total_items_processed|mysql_global_status_tokudb_cachetable_pool_cachetable_total_items_processed|mysql_global_status_tokudb_cachetable_pool_checkpoint_total_items_processed|mysql_global_status_wsrep_flow_control_paused_ns|mysql_global_status_wsrep_local_cert_failures|mysql_global_status_wsrep_local_bf_aborts|mysql_global_status_wsrep_flow_control_sent|mysql_global_status_wsrep_received_bytes|mysql_global_status_wsrep_replicated_bytes|mysql_global_status_wsrep_received|mysql_global_status_wsrep_replicated|mysql_global_status_wsrep_flow_control_recv)
      target_label: __name__
      replacement: ${1}_total
      action: replace


  - job_name: mysql-mr
    scrape_interval: 5s
    scrape_timeout:  1s
    metrics_path: /metrics-mr
    basic_auth:
      username: ENV_SERVER_USER
      password: ENV_SERVER_PASSWORD

    tls_config:
      insecure_skip_verify: true

    consul_sd_configs:
    - server:   'localhost:8500'
      datacenter: dc1
      services: ['mysql:metrics']

    relabel_configs:
    - target_label:  'job'
      replacement:   'mysql'
    - source_labels: ['__meta_consul_tags']
      regex:         '.*,alias_([-\w:\.]+),.*'
      target_label:  'instance'
      replacement:   '$1'
    - source_labels: ['__meta_consul_tags']
      regex:         '.*,scheme_([\w]+),.*'
      target_label:  '__scheme__'
      replacement:   '$1'
    - source_labels: ['__meta_consul_tags']
      regex:         '.*,region_([\w]+),.*'
      target_label:  'region'
      replacement:   '$1'


  - job_name: mysql-lr
    scrape_interval: 60s
    scrape_timeout:   5s
    metrics_path: /metrics-lr
    basic_auth:
      username: ENV_SERVER_USER
      password: ENV_SERVER_PASSWORD

    tls_config:
      insecure_skip_verify: true

    consul_sd_configs:
    - server:   'localhost:8500'
      datacenter: dc1
      services: ['mysql:metrics']

    relabel_configs:
    - target_label:  'job'
      replacement:   'mysql'
    - source_labels: ['__meta_consul_tags']
      regex:         '.*,alias_([-\w:\.]+),.*'
      target_label:  'instance'
      replacement:   '$1'
    - source_labels: ['__meta_consul_tags']
      regex:         '.*,scheme_([\w]+),.*'
      target_label:  '__scheme__'
      replacement:   '$1'
    - source_labels: ['__meta_consul_tags']
      regex:         '.*,region_([\w]+),.*'
      target_label:  'region'
      replacement:   '$1'

    metric_relabel_configs:
    - source_labels: [__name__]
      separator: ;
      regex: (mysql_info_schema_user_statistics_total_connections)
      target_label: __name__
      replacement: ${1}_count
      action: replace

storage:
  tsdb:
    out_of_order_time_window: 10y